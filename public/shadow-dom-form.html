<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow DOM Embedded Form</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #d8b4fe, #4c1d95);
            padding: 40px 20px;
            min-height: 100vh;
            color: #f9fafb;
        }
        .container {
            max-width: 780px;
            margin: 0 auto;
            background: #020617;
            border-radius: 18px;
            padding: 32px 28px 40px;
            box-shadow: 0 20px 60px rgba(15,23,42,0.8);
            border: 1px solid rgba(148,163,184,0.4);
        }
        h1 {
            font-size: 26px;
            margin-bottom: 8px;
        }
        .subtitle {
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 20px;
        }
        .note {
            font-size: 12px;
            color: #e5e7eb;
            background: rgba(15,23,42,0.9);
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px dashed rgba(148,163,184,0.7);
            margin-bottom: 18px;
        }
        shadow-form-shell {
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <a href="/" style="display:inline-block;margin-bottom:14px;color:#a5b4fc;text-decoration:none;font-size:13px;">← Back to home</a>
    <h1>Shadow DOM Embedded Form</h1>
    <p class="subtitle">Tests scanners that need to traverse inside a web component's shadow root to discover form fields.</p>
    <div class="note">
        The form below lives entirely inside a custom element's <code>shadowRoot</code>.
        Basic scanners that only see light DOM will miss it.
    </div>

    <shadow-form-shell></shadow-form-shell>

    <div id="outerMessage" style="margin-top:18px;font-size:13px;display:none;"></div>
</div>

<script>
class ShadowFormShell extends HTMLElement {
    constructor() {
        super();
        const shadow = this.attachShadow({ mode: 'open' });

        const wrapper = document.createElement('div');
        wrapper.setAttribute('part', 'wrapper');
        wrapper.style.background = 'linear-gradient(135deg, #0f172a, #1f2937)';
        wrapper.style.padding = '20px 18px 22px';
        wrapper.style.borderRadius = '14px';
        wrapper.style.border = '1px solid rgba(148,163,184,0.6)';

        const title = document.createElement('h2');
        title.textContent = 'Newsletter Signup (Shadow DOM)';
        title.style.fontSize = '18px';
        title.style.margin = '0 0 4px 0';
        title.style.color = '#e5e7eb';

        const subtitle = document.createElement('p');
        subtitle.textContent = 'Fields and the <form> element are all inside shadowRoot.';
        subtitle.style.fontSize = '12px';
        subtitle.style.color = '#9ca3af';
        subtitle.style.margin = '0 0 16px 0';

        const form = document.createElement('form');
        form.id = 'shadowForm';
        form.setAttribute('novalidate', '');

        const style = document.createElement('style');
        style.textContent = `
          .form-group { margin-bottom: 12px; }
          label { display:block; font-size:12px; margin-bottom:4px; color:#e5e7eb; }
          input, select {
            width: 100%;
            padding: 7px 9px;
            border-radius: 8px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #f9fafb;
            font-size: 13px;
          }
          input:focus, select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 1px #4f46e533;
          }
          button {
            margin-top: 6px;
            background: #4f46e5;
            color: #e5e7eb;
            border-radius: 999px;
            padding: 8px 16px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
          }
          button:hover { background:#4338ca; }
          .message { margin-top:10px;font-size:12px; }
          .message.success { color:#bbf7d0; }
          .message.error { color:#fecaca; }
        `;

        const group1 = document.createElement('div');
        group1.className = 'form-group';
        const label1 = document.createElement('label');
        label1.setAttribute('for', 'shadow_name');
        label1.textContent = 'Full name *';
        const input1 = document.createElement('input');
        input1.id = 'shadow_name';
        input1.name = 'fullName';
        input1.required = true;

        const group2 = document.createElement('div');
        group2.className = 'form-group';
        const label2 = document.createElement('label');
        label2.setAttribute('for', 'shadow_email');
        label2.textContent = 'Email address *';
        const input2 = document.createElement('input');
        input2.id = 'shadow_email';
        input2.name = 'email';
        input2.type = 'email';
        input2.required = true;

        const group3 = document.createElement('div');
        group3.className = 'form-group';
        const label3 = document.createElement('label');
        label3.setAttribute('for', 'shadow_plan');
        label3.textContent = 'Plan';
        const select = document.createElement('select');
        select.id = 'shadow_plan';
        select.name = 'plan';
        ['Free', 'Pro', 'Enterprise'].forEach((val) => {
            const opt = document.createElement('option');
            opt.value = val.toLowerCase();
            opt.textContent = val;
            select.appendChild(opt);
        });

        const button = document.createElement('button');
        button.type = 'submit';
        button.textContent = 'Join newsletter';

        const message = document.createElement('div');
        message.className = 'message';
        message.id = 'shadowMessage';

        group1.appendChild(label1);
        group1.appendChild(input1);
        group2.appendChild(label2);
        group2.appendChild(input2);
        group3.appendChild(label3);
        group3.appendChild(select);

        form.appendChild(group1);
        form.appendChild(group2);
        form.appendChild(group3);
        form.appendChild(button);
        form.appendChild(message);

        wrapper.appendChild(title);
        wrapper.appendChild(subtitle);
        wrapper.appendChild(form);

        shadow.appendChild(style);
        shadow.appendChild(wrapper);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const outerMsg = document.getElementById('outerMessage');
            message.textContent = '';
            outerMsg.style.display = 'none';

            if (!input1.value.trim() || !input2.value.trim()) {
                message.textContent = '❌ Please fill in required fields.';
                message.className = 'message error';
                return;
            }

            const payload = {
                fullName: input1.value,
                email: input2.value,
                plan: select.value
            };

            try {
                const res = await fetch('/api/submit-shadow-form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await res.json();
                message.className = 'message ' + (result.success ? 'success' : 'error');
                message.textContent = (result.success ? '✅ ' : '❌ ') + (result.message || 'Submission result');

                outerMsg.style.display = 'block';
                outerMsg.textContent = 'Outer page can react to shadow form submission as well.';
            } catch (err) {
                message.className = 'message error';
                message.textContent = '❌ Network error while submitting shadow form.';
            }
        });
    }
}

customElements.define('shadow-form-shell', ShadowFormShell);
</script>
</body>
</html>
